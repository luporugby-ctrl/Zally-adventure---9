<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ZALLY'S HOOPS: PRECISION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --zalando-orange: #ff6900;
            --zalando-black: #1a1a1a;
            --neon-green: #00ff00;
        }

        body {
            background-color: #111;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Press Start 2P', cursive;
            color: white;
            user-select: none;
        }

        #arcade-machine {
            position: relative;
            width: 1024px;
            height: 768px;
            background: #000;
            border: 8px solid var(--zalando-orange);
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 105, 0, 0.3);
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .hud-top {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            font-size: 20px;
            text-shadow: 2px 2px #000;
        }

        canvas { display: block; image-rendering: pixelated; }

        /* SCREENS */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .code-box {
            background: #222;
            border: 2px solid var(--zalando-orange);
            color: var(--neon-green);
            padding: 20px;
            margin: 20px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            text-align: left;
            max-width: 80%;
        }

        button {
            background: var(--zalando-orange);
            color: white;
            border: 4px solid #fff;
            padding: 20px 40px;
            font-family: 'Press Start 2P';
            font-size: 20px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover { transform: scale(1.05); }

        .controls-hint {
            margin-top: 30px;
            font-size: 12px;
            color: #aaa;
            line-height: 2;
        }
        .key {
            background: #444;
            padding: 5px 10px;
            border-radius: 4px;
            color: #fff;
            border-bottom: 3px solid #222;
        }

    </style>
</head>
<body>

<div id="arcade-machine">
    <canvas id="gameCanvas" width="1024" height="768"></canvas>
    
    <div id="ui-layer">
        <div class="hud-top">
            <div id="scoreDisplay">SCORE: 0000</div>
            <div id="levelDisplay">LEVEL 1</div>
        </div>
    </div>

    <div id="startScreen" class="screen">
        <h1 style="color:var(--zalando-orange); font-size:40px;">ZALLY'S HOOPS</h1>
        <p style="color:var(--neon-green)">PROMPT OPS EDITION</p>
        
        <div class="controls-hint">
            <span class="key">⬅️</span> <span class="key">➡️</span>  AIM (MIRA)<br><br>
            <span class="key">SPACE (HOLD)</span>  CHARGE POWER<br><br>
            <span class="key">SPACE (RELEASE)</span>  SHOOT!
        </div>

        <button onclick="game.init()">START GAME</button>
    </div>

    <div id="levelScreen" class="screen" style="display:none;">
        <h1 style="color:var(--neon-green)">LEVEL CLEARED!</h1>
        <p id="levelDesc" style="max-width:700px; line-height:1.5; color:#ccc;"></p>
        <div class="code-box" id="levelCode"></div>
        <button onclick="game.nextLevel()">NEXT LEVEL</button>
    </div>
</div>

<script>
/**
 * ZALLY'S HOOPS - PRECISION ENGINE
 * Controls: Arrows to Aim, Hold Space to Shoot
 */

const CONFIG = {
    colors: {
        orange: '#ff6900',
        white: '#ffffff',
        skyTop: '#050510',
        skyBot: '#202040'
    },
    gravity: 0.6,
    levels: [
        {
            title: "LEVEL 1: FEW-SHOT",
            dist: 450,
            wind: 0,
            req: 1,
            desc: "GEMINI NEEDS CONTEXT. Don't be vague. Give 2-3 examples of what you want (Input -> Output) to get the perfect format.",
            code: "PROMPT:\n'Convert these emails to tickets. Follow this example:'\nInput: [Email Text] -> Output: [Ticket ID, Summary]\nInput: [Email Text] -> Output: [Ticket ID, Summary]\nNow do this: [New Email]"
        },
        {
            title: "LEVEL 2: CHAIN OF THOUGHT",
            dist: 600,
            wind: 0,
            req: 1,
            desc: "COMPLEX LOGIC? FORCE A PLAN. Use the magic phrase 'Think Step-by-Step' to stop Gemini from guessing.",
            code: "PROMPT:\n'Analyze the Q3 Variance Report.'\nTHINK STEP-BY-STEP:\n1. Identify categories over budget\n2. Calculate % difference\n3. List top 3 offenders"
        },
        {
            title: "LEVEL 3: DELIMITERS",
            dist: 550,
            wind: 1.5,
            req: 2,
            desc: "CLEAN UP THE MESS. Use ### to separate your instructions from the dirty data you paste.",
            code: "PROMPT:\n'Extract dates from the text between ###'\n###\n[Paste messy supplier email here]\n###"
        },
        {
            title: "LEVEL 4: KEYWORDS",
            dist: 700,
            wind: 0.5,
            req: 2,
            desc: "USE POWER WORDS. Ask for specific formats: [TABLE], [PYTHON SCRIPT], [JSON], [CSV].",
            code: "PROMPT:\n'Analyze this feedback.\nOutput format: A [TABLE] with columns: Sentiment, Key Issue, Urgency.\nThen write a [PYTHON SCRIPT] to chart it.'"
        }
    ]
};

// AUDIO SYSTEM
const AudioSys = {
    ctx: null,
    init() {
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        this.ctx = new AudioContext();
    },
    play(freq, type, dur, vol=0.1) {
        if(!this.ctx) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + dur);
    },
    chargeSound(vol) {
        // Continuous rising pitch
        if(!this.ctx) return;
        this.play(200 + (vol*5), 'sawtooth', 0.1, 0.05);
    }
};

class Game {
    constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        
        // Input State
        this.keys = { left:false, right:false, space:false };
        
        // Game Objects
        this.ball = { x:0, y:0, vx:0, vy:0, active:false };
        this.player = { x:100, y:550 };
        this.hoop = { x:800, y:250 };
        
        // Game State
        this.state = 'MENU'; // MENU, PLAY, FLIGHT, ANIMATING
        this.levelIdx = 0;
        this.score = 0;
        this.shotsMade = 0;

        // Shot Params
        this.angle = 45;
        this.power = 0;
        this.wind = 0;

        // Visuals
        this.particles = [];
        this.floaters = [];

        // Events
        window.addEventListener('keydown', e => this.onKey(e, true));
        window.addEventListener('keyup', e => this.onKey(e, false));
        
        // Loop
        this.loop = this.loop.bind(this);
        requestAnimationFrame(this.loop);
    }

    onKey(e, isDown) {
        if(e.code === 'ArrowLeft') this.keys.left = isDown;
        if(e.code === 'ArrowRight') this.keys.right = isDown;
        
        if(e.code === 'Space') {
            if(this.state === 'MENU') return; // Handled by button
            
            // SHOOT ON RELEASE
            if(this.keys.space && !isDown && this.state === 'PLAY' && this.power > 0) {
                this.shoot();
            }
            this.keys.space = isDown;
        }
    }

    init() {
        document.getElementById('startScreen').style.display = 'none';
        AudioSys.init();
        this.startLevel(0);
    }

    startLevel(idx) {
        this.levelIdx = idx;
        this.shotsMade = 0;
        document.getElementById('levelScreen').style.display = 'none';
        this.updateHUD();
        this.resetShot();
    }

    resetShot() {
        this.state = 'PLAY';
        this.ball.active = false;
        this.power = 0;
        this.angle = 45;
        
        const lvl = CONFIG.levels[this.levelIdx];
        this.player.x = this.hoop.x - lvl.dist;
        this.ball.x = this.player.x + 40;
        this.ball.y = this.player.y - 20;
        
        this.wind = lvl.wind ? (Math.random()*lvl.wind - lvl.wind/2) : 0;
    }

    update() {
        // 1. INPUT HANDLING (AIMING & CHARGING)
        if(this.state === 'PLAY') {
            // Aim
            if(this.keys.left && this.angle < 85) this.angle += 1.5;
            if(this.keys.right && this.angle > 10) this.angle -= 1.5;

            // Charge
            if(this.keys.space) {
                if(this.power < 100) {
                    this.power += 1.5;
                    if(this.power % 10 < 2) AudioSys.chargeSound(this.power);
                }
            } else {
                // Decay power if space released but not shot (rare edge case)
                if(this.power > 0 && !this.ball.active) this.power = 0;
            }
        }

        // 2. BALL PHYSICS
        if(this.state === 'FLIGHT' && this.ball.active) {
            this.ball.vy += CONFIG.gravity;
            this.ball.vx *= 0.995; // Drag
            this.ball.x += this.ball.vx + this.wind;
            this.ball.y += this.ball.vy;

            // Floor
            if(this.ball.y > 650) {
                this.ball.y = 650;
                this.ball.vy *= -0.6;
                this.ball.vx *= 0.8;
                if(Math.abs(this.ball.vy) < 1) this.fail("TOO SHORT");
            }

            // Hoop Detection (Simplified Box + Circle)
            let dx = this.ball.x - (this.hoop.x + 25);
            let dy = this.ball.y - this.hoop.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            // Hit Rim?
            if(dist < 50 && this.ball.vy > 0) {
                this.success();
            }

            // Out of bounds
            if(this.ball.x > 1024) this.fail("AIRBALL");
        }

        // 3. PARTICLES
        this.particles.forEach((p,i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            if(p.life <= 0) this.particles.splice(i,1);
        });

        // 4. FLOATERS
        this.floaters.forEach((f,i) => {
            f.y -= 1; f.life--;
            if(f.life <= 0) this.floaters.splice(i,1);
        });
    }

    shoot() {
        this.state = 'FLIGHT';
        this.ball.active = true;
        AudioSys.play(150, 'square', 0.2);

        const rad = (this.angle * Math.PI) / 180;
        const speed = (this.power / 100) * 22 + 10;

        this.ball.vx = Math.cos(rad) * speed;
        this.ball.vy = -Math.sin(rad) * speed;
    }

    success() {
        if(this.state === 'ANIMATING') return;
        this.state = 'ANIMATING';
        this.score += 500;
        this.shotsMade++;
        AudioSys.play(600, 'triangle', 0.1);
        setTimeout(()=>AudioSys.play(900, 'triangle', 0.3), 100);

        this.spawnParticles(this.hoop.x+25, this.hoop.y, 30, '#ff6900');
        this.spawnFloater("SWISH!", this.hoop.x, this.hoop.y-50, '#0f0');

        this.updateHUD();

        setTimeout(() => {
            if(this.shotsMade >= CONFIG.levels[this.levelIdx].req) {
                this.showLevelUp();
            } else {
                this.resetShot();
            }
        }, 1500);
    }

    fail(reason) {
        if(this.state === 'ANIMATING') return;
        this.state = 'ANIMATING';
        AudioSys.play(100, 'sawtooth', 0.3);
        this.spawnFloater(reason, this.ball.x, this.ball.y-50, '#f00');
        setTimeout(() => this.resetShot(), 1000);
    }

    // DRAWING
    draw() {
        // Clear
        this.ctx.fillStyle = CONFIG.colors.skyTop;
        this.ctx.fillRect(0,0,1024,768);
        
        // Draw City
        this.drawCity();

        // Floor
        this.ctx.fillStyle = '#222';
        this.ctx.fillRect(0, 650, 1024, 118);
        this.ctx.fillStyle = CONFIG.colors.orange;
        this.ctx.fillRect(0, 650, 1024, 5);

        // Hoop
        const hx = this.hoop.x; const hy = this.hoop.y;
        this.ctx.fillStyle = '#555'; this.ctx.fillRect(hx+60, hy, 10, 650-hy); // Pole
        this.ctx.fillStyle = '#fff'; this.ctx.fillRect(hx+50, hy-80, 5, 90); // Board
        this.ctx.fillStyle = CONFIG.colors.orange; this.ctx.fillRect(hx, hy, 50, 5); // Rim

        // Player (Zally 8-bit)
        this.drawZally();

        // Ball
        if(this.ball.active) {
            this.ctx.fillStyle = CONFIG.colors.orange;
            this.ctx.beginPath(); this.ctx.arc(this.ball.x, this.ball.y, 12, 0, Math.PI*2); this.ctx.fill();
        }

        // Aim Line & Power
        if(this.state === 'PLAY') this.drawUI();

        // FX
        this.particles.forEach(p => {
            this.ctx.fillStyle = p.c; this.ctx.fillRect(p.x, p.y, 6, 6);
        });
        this.floaters.forEach(f => {
            this.ctx.fillStyle = f.c; this.ctx.font = "20px 'Press Start 2P'"; this.ctx.fillText(f.txt, f.x, f.y);
        });
    }

    drawZally() {
        const px = this.player.x; const py = this.player.y;
        this.ctx.save();
        this.ctx.translate(px, py);
        // Body
        this.ctx.fillStyle = CONFIG.colors.orange; this.ctx.fillRect(0, 0, 40, 60);
        // Head
        this.ctx.fillStyle = '#ffccaa'; this.ctx.fillRect(5, -20, 30, 20);
        // Hat
        this.ctx.fillStyle = '#000'; this.ctx.fillRect(5, -25, 30, 5); this.ctx.fillRect(25, -25, 15, 5);
        this.ctx.restore();
    }

    drawCity() {
        this.ctx.fillStyle = '#101020';
        for(let i=0; i<15; i++) {
            let h = 100 + Math.sin(i*132)*80;
            this.ctx.fillRect(i*80, 650-h, 75, h);
            this.ctx.fillStyle = Math.random()>0.95 ? '#ff6900' : '#050510';
            this.ctx.fillRect(i*80+10, 650-h+20, 5, 5);
            this.ctx.fillStyle = '#101020';
        }
    }

    drawUI() {
        const ax = this.player.x + 40; const ay = this.player.y;
        const len = 80;
        const rad = -(this.angle * Math.PI)/180;

        // Aim Line
        this.ctx.strokeStyle = '#fff';
        this.ctx.setLineDash([5,5]);
        this.ctx.lineWidth = 2;
        this.ctx.beginPath();
        this.ctx.moveTo(ax, ay);
        this.ctx.lineTo(ax + Math.cos(rad)*len, ay + Math.sin(rad)*len);
        this.ctx.stroke();
        this.ctx.setLineDash([]);

        // Power Bar
        this.ctx.fillStyle = '#fff';
        this.ctx.fillRect(ax-20, ay-50, 60, 10);
        this.ctx.fillStyle = this.power > 90 ? '#f00' : CONFIG.colors.orange;
        this.ctx.fillRect(ax-20, ay-50, (this.power/100)*60, 10);
    }

    spawnParticles(x, y, count, c) {
        for(let i=0; i<count; i++) {
            this.particles.push({
                x:x, y:y, 
                vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10, 
                life:1.0, c:c
            });
        }
    }
    spawnFloater(txt, x, y, c) {
        this.floaters.push({txt, x, y, c, life:60});
    }

    updateHUD() {
        document.getElementById('scoreDisplay').innerText = "SCORE: " + this.score.toString().padStart(4,'0');
        document.getElementById('levelDisplay').innerText = CONFIG.levels[this.levelIdx].title;
    }

    showLevelUp() {
        const lvl = CONFIG.levels[this.levelIdx];
        document.getElementById('levelDesc').innerText = lvl.desc;
        document.getElementById('levelCode').innerText = lvl.code;
        document.getElementById('levelScreen').style.display = 'flex';
    }

    nextLevel() {
        if(this.levelIdx + 1 < CONFIG.levels.length) {
            this.startLevel(this.levelIdx + 1);
        } else {
            alert("ALL LEVELS COMPLETE! CHAMPION STATUS ACHIEVED.");
            location.reload();
        }
    }

    loop() {
        this.update();
        this.draw();
        requestAnimationFrame(this.loop);
    }
}

const game = new Game();
</script>
</body>
</html>
