<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Zally's Nothing But Net: Prompt Engineering</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            background-color: #222;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background: linear-gradient(to bottom, #2c3e50, #000); /* Night Sky */
            border: 4px solid #ff6900;
            box-shadow: 0 0 30px rgba(255, 105, 0, 0.4);
            overflow: hidden;
        }

        canvas { display: block; }

        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 760px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            text-shadow: 2px 2px #000;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            background: #111;
            border: 4px solid #fff;
            padding: 20px;
            z-index: 20;
            text-align: center;
            box-shadow: 10px 10px 0 #ff6900;
        }

        .btn {
            background: #ff6900;
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
        }
        .btn:hover { background: #ff8c00; transform: scale(1.05); }

        .highlight { color: #ff6900; display: block; margin-bottom: 10px; font-size: 18px; }
        .prompt-box {
            background: #222;
            border-left: 5px solid #ff6900;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
            font-size: 10px;
            line-height: 1.6;
            color: #0f0;
            font-family: monospace;
        }

        /* Power Bar & Angle Indicator UI */
        #controls-ui {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            font-size: 10px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div id="ui-layer">
        <div id="score">SCORE: 0</div>
        <div id="level-name">LVL 1: FEW-SHOT</div>
    </div>

    <div id="controls-ui">
        PRESS [SPACE] TO AIM & SHOOT
    </div>

    <div id="start-screen" class="modal" style="display: block;">
        <h1 style="color:#ff6900">NOTHING BUT NET</h1>
        <p style="font-size: 12px; color: #aaa;">PROMPT ENGINEERING EDITION</p>
        <p style="font-size: 10px; margin: 30px 40px; text-align: left; line-height: 1.8;">
            Il Prompting è questione di precisione.<br>
            Troppo vago? <span style="color:red">AIRBALL.</span><br>
            Troppo complesso? <span style="color:red">FERRO.</span><br><br>
            1. Premi SPAZIO per l'ANGOLO (Mira).<br>
            2. Premi SPAZIO per la POTENZA (Contesto).<br>
            3. Fai centro per sbloccare la tecnica.
        </p>
        <button class="btn" onclick="startGame()">SCENDI IN CAMPO</button>
    </div>

    <div id="edu-modal" class="modal">
        <h2 class="highlight" id="edu-title">SWISH!</h2>
        <p id="edu-desc" style="font-size: 10px;">Spiegazione tecnica...</p>
        <div class="prompt-box" id="edu-prompt">Esempio Prompt...</div>
        <button class="btn" onclick="nextLevel()">PROSSIMO TIRO</button>
    </div>
</div>

<script>
/**
 * ZALLY'S NOTHING BUT NET
 * Physics-based Prompting Game
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- ASSETS ---
const PLAYER_IMG_SRC = 'zally-basket.png';
const zallySprite = new Image();
zallySprite.src = PLAYER_IMG_SRC;
let isImageLoaded = false;
zallySprite.onload = () => { isImageLoaded = true; };

// --- GAME STATE ---
let gameState = 'START'; // START, AIMING, POWERING, SHOOTING, RESULT
let currentLevel = 0;
let score = 0;

// Physics Variables
let ball = { x: 0, y: 0, vx: 0, vy: 0, r: 12, active: false };
const gravity = 0.5;
const friction = 0.99;

// Shooting Mechanics
let angle = 45;
let angleSpeed = 1.5;
let angleDir = 1;
let power = 0;
let powerSpeed = 2;
let powerDir = 1;

// Court Dimensions
const floorY = 550;
const hoopX = 700;
const hoopY = 250;
const hoopR = 25; // Radius of the rim detection

// --- LEVELS DATA ---
const levels = [
    {
        name: "TIRO LIBERO (FEW-SHOT)",
        distance: 150, // Distanza da sottrarre alla X del hoop
        desc: "Hai usato il 'Few-Shot'! Dare esempi a Gemini è come allenarsi ai tiri liberi: la ripetizione crea precisione.",
        prompt: "PROMPT:\n'Agisci come un analista senior.\nEsempio 1: [Dati] -> [Report Sintetico]\nEsempio 2: [Dati] -> [Report Sintetico]\nOra trasforma questi nuovi dati seguendo lo stesso formato.'"
    },
    {
        name: "TIRO DA 3 (CHAIN OF THOUGHT)",
        distance: 300,
        desc: "BOOM! Da lontano serve ragionamento. Hai chiesto a Gemini di pensare 'step-by-step' prima di rispondere.",
        prompt: "PROMPT:\n'Analizza la discrepanza in fattura.\nStep 1: Confronta PO e Fattura.\nStep 2: Identifica l'IVA applicata.\nStep 3: Scrivi la mail di contestazione solo se la differenza > 10€.'"
    },
    {
        name: "META' CAMPO (DELIMITERS)",
        distance: 500,
        desc: "Incredibile! Con dati sporchi e distanti, i delimitatori (###) sono l'unica salvezza per non perdere la palla.",
        prompt: "PROMPT:\n'Analizza SOLO il testo tra ###.\n###\n[EMAIL FORNITORE CONFUSA]\n###\nEstrai la data di consegna.'"
    },
    {
        name: "BUZZER BEATER (ITERATION)",
        distance: 400, // Variabile
        movingHoop: true, // Difficulty spike
        desc: "Vittoria! Hai imparato che il primo prompt non è mai perfetto. Hai iterato finché non hai fatto centro.",
        prompt: "PROMPT:\n'La risposta è corretta ma il tono è troppo aggressivo. Riscrivila in modo più empatico e accorciala del 50%.'"
    }
];

// --- LOGIC ---

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    setupLevel();
}

function setupLevel() {
    if (currentLevel >= levels.length) {
        alert("CAMPIONE! Hai completato l'allenamento Ops!");
        location.reload();
        return;
    }
    
    gameState = 'AIMING';
    document.getElementById('level-name').innerText = levels[currentLevel].name;
    
    // Reset Ball Position based on level distance
    ball.active = false;
    ball.x = hoopX - levels[currentLevel].distance;
    ball.y = floorY - 80; // Altezza mani Zally
    
    angle = 45;
    power = 0;
}

function update() {
    if (gameState === 'AIMING') {
        angle += angleSpeed * angleDir;
        if (angle > 80 || angle < 10) angleDir *= -1;
    } 
    else if (gameState === 'POWERING') {
        power += powerSpeed * powerDir;
        if (power > 100 || power < 0) powerDir *= -1;
    }
    else if (gameState === 'SHOOTING') {
        // Physics
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.vy += gravity;

        // Bounce Floor
        if (ball.y > floorY - ball.r) {
            ball.y = floorY - ball.r;
            ball.vy *= -0.6; // Energy loss
            ball.vx *= friction;
            
            // Se si ferma a terra e non ha segnato
            if (Math.abs(ball.vx) < 0.1 && Math.abs(ball.vy) < 0.1) {
                setTimeout(resetShot, 1000);
            }
        }

        // Check Basket Collision (Simplified)
        let dx = ball.x - hoopX;
        let dy = ball.y - hoopY;
        let distance = Math.sqrt(dx*dx + dy*dy);

        // Se la palla è vicina al centro del canestro E sta scendendo
        if (distance < 25 && ball.vy > 0) {
            score++;
            document.getElementById('score').innerText = `SCORE: ${score}`;
            gameState = 'RESULT';
            showSuccess();
        }
        
        // Out of bounds
        if (ball.x > canvas.width + 50) {
            setTimeout(resetShot, 1000);
        }
    }
}

function resetShot() {
    ball.active = false;
    ball.x = hoopX - levels[currentLevel].distance;
    ball.y = floorY - 80;
    gameState = 'AIMING';
    power = 0;
    // Feedback visivo "MISS" potrebbe andare qui
}

function shoot() {
    gameState = 'SHOOTING';
    ball.active = true;
    
    // Calcola vettori
    let rad = angle * Math.PI / 180;
    // La potenza deve essere calibrata per la distanza. 
    // Valore empirico: Power 0-100 mappa a velocity 0-25
    let velocity = power * 0.25 + 5; 
    
    ball.vx = Math.cos(rad) * velocity;
    ball.vy = -Math.sin(rad) * velocity;
}

function showSuccess() {
    const lvl = levels[currentLevel];
    const modal = document.getElementById('edu-modal');
    document.getElementById('edu-title').innerText = "NOTHING BUT NET!";
    document.getElementById('edu-desc').innerText = lvl.desc;
    document.getElementById('edu-prompt').innerText = lvl.prompt;
    modal.style.display = 'block';
}

function nextLevel() {
    document.getElementById('edu-modal').style.display = 'none';
    currentLevel++;
    setupLevel();
}

// --- DRAWING ---

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. Draw Environment
    // Floor
    ctx.fillStyle = "#e67e22"; // Wood color
    ctx.fillRect(0, floorY, canvas.width, canvas.height - floorY);
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, floorY); ctx.lineTo(canvas.width, floorY);
    ctx.stroke();

    // 2. Draw Hoop (Right Side)
    ctx.fillStyle = "#ecf0f1"; // Pole
    ctx.fillRect(hoopX + 40, hoopY - 50, 10, floorY - (hoopY - 50));
    ctx.fillStyle = "orange"; // Rim
    ctx.fillRect(hoopX, hoopY, 40, 5);
    ctx.strokeStyle = "white"; // Net
    ctx.beginPath();
    ctx.moveTo(hoopX, hoopY+5); ctx.lineTo(hoopX+10, hoopY+35);
    ctx.moveTo(hoopX+40, hoopY+5); ctx.lineTo(hoopX+30, hoopY+35);
    ctx.moveTo(hoopX+10, hoopY+35); ctx.lineTo(hoopX+30, hoopY+35);
    ctx.stroke();

    // 3. Draw Zally (Player)
    let playerX = hoopX - levels[currentLevel].distance - 20;
    let playerY = floorY - 100;

    if (isImageLoaded) {
        ctx.drawImage(zallySprite, playerX, playerY, 80, 100);
    } else {
        ctx.fillStyle = "#ff6900";
        ctx.fillRect(playerX, playerY, 40, 100);
        // Head
        ctx.fillStyle = "#ffccaa";
        ctx.fillRect(playerX+5, playerY-20, 30, 30);
    }

    // 4. Draw Ball
    if (gameState !== 'RESULT') {
        let bx = ball.active ? ball.x : playerX + 40;
        let by = ball.active ? ball.y : playerY + 30;
        
        ctx.fillStyle = "#e74c3c";
        ctx.beginPath();
        ctx.arc(bx, by, ball.r, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;
        ctx.stroke();
    }

    // 5. Draw UI (Arrow & Power Bar)
    if (gameState === 'AIMING' || gameState === 'POWERING') {
        let startX = playerX + 40;
        let startY = playerY + 30;
        let lineLen = 100;
        
        // Arrow
        let rad = -angle * Math.PI / 180;
        let endX = startX + Math.cos(rad) * lineLen;
        let endY = startY + Math.sin(rad) * lineLen;
        
        ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.stroke();

        // Power Bar Background
        ctx.fillStyle = "#333";
        ctx.fillRect(playerX - 20, playerY - 40, 80, 10);
        
        // Power Bar Fill
        let fillWidth = (power / 100) * 80;
        let color = power > 90 ? "red" : (power > 50 ? "yellow" : "green");
        ctx.fillStyle = color;
        ctx.fillRect(playerX - 20, playerY - 40, fillWidth, 10);
        
        // Instructions
        ctx.fillStyle = "#fff";
        ctx.font = "10px monospace";
        if (gameState === 'AIMING') ctx.fillText(`ANGOLO: ${Math.round(angle)}°`, playerX - 20, playerY - 50);
        if (gameState === 'POWERING') ctx.fillText(`POTENZA: ${Math.round(power)}%`, playerX - 20, playerY - 50);
    }

    requestAnimationFrame(update);
    requestAnimationFrame(draw);
}

// --- CONTROLS ---
window.addEventListener('keydown', e => {
    if (e.code === 'Space') {
        if (gameState === 'AIMING') {
            gameState = 'POWERING';
        } else if (gameState === 'POWERING') {
            shoot();
        }
    }
});

// Init
draw();

</script>
</body>
</html>
